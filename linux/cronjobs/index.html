<!doctype html><html lang=en-us><head><title>cronjobs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><style>@import "https://fonts.googleapis.com/css2?family=Inconsolata&display=swap";:root{--cursor-visibility:hidden}html,body{width:100%;height:100%;overflow:auto;font-family:inconsolata,monospace;font-size:4vmin;line-height:4.1vmin;font-weight:400}body{margin:0;display:flex;flex-direction:row;justify-content:center;align-items:center}#content{min-width:82vmin;min-height:82vmin}::-webkit-scrollbar{width:10px}::-webkit-scrollbar-track{border-radius:10px;box-shadow:inset 0 0 1px white}::-webkit-scrollbar-thumb{border-radius:10px;box-shadow:0 0 0 1px white}.cursor,#activity-title:after,#activity-content:after,#cd:after,#whoami:after,#cat:after,#tree:after{visibility:var(--cursor-visibility);content:"|";overflow:hidden;color:#fff;animation:blink 500ms linear infinite alternate}@keyframes blink{0%{opacity:0}100%{opacity:1}}@media only screen and (min-width:768px){body{font-size:2.5vmin;line-height:2.6vmin}#content{min-width:60vmin}}:root{--cursor-visibility:hidden}body{align-items:unset;overflow-y:scroll}#content{max-width:80vmin}pre{overflow-x:scroll;white-space:pre}@keyframes blink{0%{opacity:0}100%{opacity:1}}body{background:#002b36}body #terminal{color:#839496}body #user{color:#859900}body #dir{color:#268bd2}body .Typewriter__cursor{color:#839496}a{color:#839496}.navFull{background-color:#353535;font-family:courier new;font-size:17px;display:inline;position:fixed;bottom:0;left:0;width:100%;padding-top:5px;padding:10px;padding-bottom:0}.navCredits{float:right;padding-right:18px;padding-bottom:10px;padding-top:5px}#content::after{content:"\a\a";white-space:pre}</style></head><body><div id=content><span id=activity-title></span><br><span id=activity-content></span><br><script type=text/javascript>async function typewriter(e,t,n){var s=0,o=!1;addText="";const i=document.getElementById(t),a=()=>new Promise(e=>setTimeout(e,n)),r=()=>new Promise(e=>e()),c=()=>i.innerHTML=e.slice(0,s+1)+addText,l=document.createElement("span");for(l.id="blink",i.style.setProperty("--cursor-visibility","visible");s<e.length;){if(e.charAt(s+1)==="<"&&(o=!0),e.charAt(s+1)===">"&&(o=!1),o){s++;continue}requestAnimationFrame(c),n===0?await r():await a(),s++}i.style.setProperty("--cursor-visibility","collapse")}function parseDelay(e){const t=parseInt(e,10);return isNaN(t)?0:t}const titleDelay=parseDelay("0"),contentDelay=parseDelay("0"),typeeffetct=async()=>{await typewriter("\u003cspan id=\u0027terminal\u0027\u003e\u003ch1 id=\u0027title\u0027\u003ecronjobs\u003c/h1\u003e\u003c/span\u003e","activity-title",titleDelay),await typewriter(`\u003cspan id=\u0027terminal\u0027\u003e\u003cp\u003eCronjobs are usefull for different maintenance tasks. This page lists some tipps and tricks about them.\u003c/p\u003e
\u003ch2 id=\u0022scheduling-cronjobs\u0022\u003eScheduling cronjobs\u003c/h2\u003e
\u003cp\u003eWhen you have seen the cron scheduling syntax \u003ccode\u003e*/1 * * * *\u003c/code\u003e you know how confusing it can be to find the correct schedule. Tipp: use \u003ca href=\u0022https://crontab.guru/\u0022\u003ehttps://crontab.guru/\u003c/a\u003e to figure out your schedule.\u003c/p\u003e
\u003ch2 id=\u0022send-mails-from-cronjobs\u0022\u003eSend mails from cronjobs\u003c/h2\u003e
\u003cp\u003eWe are using postfix for this. ssmtp would be more minimal but I have tried it extensively and it didn\u0026rsquo;t work.\u003c/p\u003e
\u003cp\u003eUsed \u003ca href=\u0022https://devanswers.co/postfix-external-smtp-server/\u0022\u003ethis\u003c/a\u003e tutorial and \u003ca href=\u0022https://devanswers.co/postfix-statusbounced-unknown-user-user/\u0022\u003ethis\u003c/a\u003e.\u003c/p\u003e
\u003cp\u003eSome notes:\u003c/p\u003e
\u003cul\u003e
\u003cli\u003eMy mail account is \u003ca href=\u0022mailto:root@technat.ch\u0022\u003eroot@technat.ch\u003c/a\u003e\u003c/li\u003e
\u003cli\u003eMy mail provider is \u003ca href=\u0022https://www.infomaniak.com/en\u0022\u003eInfomanaik\u003c/a\u003e using \u003ccode\u003email.infomaniak.com:465\u003c/code\u003e as SMTP server\u003c/li\u003e
\u003cli\u003eMy mail provider requires TLS, STARTTLS and the FROM address field must be \u003ca href=\u0022mailto:root@technat.cloud\u0022\u003eroot@technat.cloud\u003c/a\u003e or any alias defined in their UI.\u003c/li\u003e
\u003c/ul\u003e
\u003cp\u003eStart by installing programms:\u003c/p\u003e
\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-bash\u0022 data-lang=\u0022bash\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esudo apt-get install mailutils postfix -y
\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eChoose \u0026ldquo;Internet Site\u0026rdquo; and \u0026ldquo;localhost\u0026rdquo;.\u003c/p\u003e
\u003cp\u003eThen add the following content into \u003ccode\u003e/etc/postfix/sasl_passwd\u003c/code\u003e:\u003c/p\u003e
\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-bash\u0022 data-lang=\u0022bash\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003e\u003cspan style=\u0022color:#f92672\u0022\u003e[\u003c/span\u003email.infomaniak.com\u003cspan style=\u0022color:#f92672\u0022\u003e]\u003c/span\u003e:465 username:password
\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSave it and run the following command:\u003c/p\u003e
\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-bash\u0022 data-lang=\u0022bash\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esudo postmap /etc/postfix/sasl_passwd
\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis hashes the credentials and creates the file \u003ccode\u003e/etc/postfix/sasl_passwd.db\u003c/code\u003e.\u003c/p\u003e
\u003cp\u003eAnyway because we work with passwords let\u0026rsquo;s restrict the permissions to those files:\u003c/p\u003e
\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-bash\u0022 data-lang=\u0022bash\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esudo chown root:root /etc/postfix/sasl_passwd /etc/postfix/sasl_passwd.db
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esudo chmod \u003cspan style=\u0022color:#ae81ff\u0022\u003e0600\u003c/span\u003e /etc/postfix/sasl_passwd /etc/postfix/sasl_passwd.db
\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd then adjust the following config directives in \u003ccode\u003e/etc/postfix/main.cf\u003c/code\u003e:\u003c/p\u003e
\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-bash\u0022 data-lang=\u0022bash\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_sasl_auth_enable \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e yes
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_sasl_password_maps \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e hash:/etc/postfix/sasl_passwd
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_sasl_security_options \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e noanonymous
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_tls_CAfile \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e /etc/ssl/certs/ca-certificates.crt
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_use_tls \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e yes
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_tls_wrappermode \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e yes
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003esmtp_tls_security_level \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e encrypt
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003erelayhost \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e \u003cspan style=\u0022color:#f92672\u0022\u003e[\u003c/span\u003email.infomaniak.com\u003cspan style=\u0022color:#f92672\u0022\u003e]\u003c/span\u003e:465
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003emydestination \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e \$myhostname, localhost.\$mydomain, localhost, \$mydomain
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003emyhostname \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e localhost
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003emyorigin \u003cspan style=\u0022color:#f92672\u0022\u003e=\u003c/span\u003e /etc/mailname
\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAlso add \u003ccode\u003etechnat.ch\u003c/code\u003e (the domain you are sending mails from) in \u003ccode\u003e/etc/mailname\u003c/code\u003e.\u003c/p\u003e
\u003cp\u003eAnd then restart the service: \u003ccode\u003esudo systemctl restart postfix\u003c/code\u003e.\u003c/p\u003e
\u003cp\u003eFinally edit the \u003ccode\u003e/etc/aliases\u003c/code\u003e:\u003c/p\u003e
\u003cdiv class=\u0022highlight\u0022\u003e\u003cpre tabindex=\u00220\u0022 style=\u0022color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\u0022\u003e\u003ccode class=\u0022language-bash\u0022 data-lang=\u0022bash\u0022\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003epostmaster: root
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003etechnat: root
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003ewww-data: root
\u003c/span\u003e\u003c/span\u003e\u003cspan style=\u0022display:flex;\u0022\u003e\u003cspan\u003eroot: root@technat.cloud
\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd apply that using \u003ccode\u003esudo newaliases\u003c/code\u003e.\u003c/p\u003e
\u003cp\u003eNote: If you send mails from cronjobs, they will come from \u003ca href=\u0022mailto:username@technat.cloud\u0022\u003eusername@technat.cloud\u003c/a\u003e where username is the user that runs the cronjob. This means that if you use a mail provider that checks if the from address matches the mail of the account you must either add an alias or find out how to replace the from address.\u003c/p\u003e
\u003c/span\u003e`,"activity-content",contentDelay)};typeeffetct()</script></div><span class=navFull><span><a href=/>Home</a>
<span>&#8192;|&#8192;</span>
<a href=./..>/linux/</a></span>
<span class=navCredits>Hugo theme created by
<a href=https://github.com/Yukuro/hugo-theme-shell target=_blank rel=noopener>Yukuro</a></span></span></body></html>